let cartDrawer=document.querySelector("#tab-cart-drawer");function handelCartState(){cartDrawer.dataset.state="loaded",setTimeout(()=>{cartDrawer.dataset.state="done"},300)}class CartRemoveButton extends HTMLElement{constructor(){super(),this.addEventListener("click",event=>{event.preventDefault();const cartItems=this.closest("cart-items")||this.closest("cart-drawer-items");if(this.classList.contains("hotdeal-item-remove-button")){let idArr=this.dataset.index.split("-"),quantityArr=Array.from(document.querySelectorAll(".cart-item")).sort((a,b)=>parseInt(a.dataset.index)-parseInt(b.dataset.index)).map(item=>{let quantity=item.querySelector(".quantity__value");return parseInt(quantity.value||quantity.textContent)});idArr.forEach(index=>{quantityArr[index-1]=0}),cartItems.removeMultiple(quantityArr,0,idArr)}else cartItems.updateQuantity(this.dataset.index,0)})}}customElements.define("cart-remove-button",CartRemoveButton);class CartItems extends HTMLElement{constructor(){super(),this.lineItemStatusElement=document.getElementById("shopping-cart-line-item-status")||document.getElementById("CartDrawer-LineItemStatus");const debouncedOnChange=debounce(event=>{this.onChange(event)},ON_CHANGE_DEBOUNCE_TIMER);this.addEventListener("change",debouncedOnChange.bind(this))}cartUpdateUnsubscriber=void 0;connectedCallback(){this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,event=>{event.source!=="cart-items"&&this.onCartUpdate()})}disconnectedCallback(){this.cartUpdateUnsubscriber&&this.cartUpdateUnsubscriber()}onChange(event){this.updateQuantity(event.target.dataset.index,event.target.value,document.activeElement.getAttribute("name"))}onCartUpdate(){cartDrawer.dataset.state="loading",fetch("/cart?section_id=main-cart-items").then(response=>response.text()).then(responseText=>{const sourceQty=new DOMParser().parseFromString(responseText,"text/html").querySelector("cart-drawer-items");sourceQty&&(this.innerHTML=sourceQty.innerHTML),handelCartState()}).catch(e=>{console.error(e),handelCartState()})}getSectionsToRender(){return[{id:"main-cart-items",section:document.getElementById("main-cart-items").dataset.id,selector:".js-contents"},{id:"cart-icon-bubble",section:"cart-icon-bubble",selector:".shopify-section"},{id:"cart-live-region-text",section:"cart-live-region-text",selector:".shopify-section"},{id:"main-cart-footer",section:document.getElementById("main-cart-footer").dataset.id,selector:".js-contents"}]}removeMultiple(lines,quantity,idArr){lines.forEach(line=>this.enableLoading(line));let updates={};const body=JSON.stringify({updates:lines,sections:this.getSectionsToRender().map(section=>section.section),sections_url:window.location.pathname});cartDrawer.dataset.state="loading",fetch(`${routes.cart_update_url}`,{...fetchConfig(),body}).then(response=>response.text()).then(state=>{const parsedState=JSON.parse(state);if(parsedState.errors){quantityElement.value=quantityElement.getAttribute("value"),lines.forEach(line=>this.updateLiveRegions(line,parsedState.errors));return}idArr.forEach(id=>{let index=+id-1;publish("levents:removeCart",{data:{index}})}),this.classList.toggle("is-empty",parsedState.item_count===0);const cartDrawerWrapper=document.querySelector("cart-drawer"),cartFooter=document.getElementById("main-cart-footer");cartFooter&&cartFooter.classList.toggle("is-empty",parsedState.item_count===0),cartDrawerWrapper&&cartDrawerWrapper.classList.toggle("is-empty",parsedState.item_count===0),this.getSectionsToRender().forEach(section=>{const elementToReplace=document.getElementById(section.id).querySelector(section.selector)||document.getElementById(section.id);elementToReplace.innerHTML=this.getSectionInnerHTML(parsedState.sections[section.section],section.selector)}),publish(PUB_SUB_EVENTS.cartUpdate,{source:"cart-items"}),handelCartState()}).catch(e=>{console.log("err",e),this.querySelectorAll(".loading-overlay").forEach(overlay=>overlay.classList.add("hidden"));const errors=document.getElementById("cart-errors")||document.getElementById("CartDrawer-CartErrors");errors.textContent=window.cartStrings.error}).finally(()=>{handelCartState()})}updateQuantity(line,quantity,name){this.enableLoading(line);const body=JSON.stringify({line,quantity,sections:this.getSectionsToRender().map(section=>section.section),sections_url:window.location.pathname});cartDrawer.dataset.state="loading",fetch(`${routes.cart_change_url}`,{...fetchConfig(),body}).then(response=>response.text()).then(state=>{const parsedState=JSON.parse(state),quantityElement2=document.getElementById(`Quantity-${line}`)||document.getElementById(`Drawer-quantity-${line}`),items=document.querySelectorAll(".cart-item");if(parsedState.errors){quantityElement2.value=quantityElement2.getAttribute("value"),this.updateLiveRegions(line,parsedState.errors);return}this.classList.toggle("is-empty",parsedState.item_count===0);const cartDrawerWrapper=document.querySelector("cart-drawer"),cartFooter=document.getElementById("main-cart-footer");cartFooter&&cartFooter.classList.toggle("is-empty",parsedState.item_count===0),cartDrawerWrapper&&cartDrawerWrapper.classList.toggle("is-empty",parsedState.item_count===0),this.getSectionsToRender().forEach(section=>{const elementToReplace=document.getElementById(section.id).querySelector(section.selector)||document.getElementById(section.id);elementToReplace.innerHTML=this.getSectionInnerHTML(parsedState.sections[section.section],section.selector)});const updatedValue=parsedState.items[line-1]?parsedState.items[line-1].quantity:void 0;let message="";items.length===parsedState.items.length&&updatedValue!==parseInt(quantityElement2.value)&&(typeof updatedValue>"u"?message=window.cartStrings.error:message=window.cartStrings.quantityError.replace("[quantity]",updatedValue)),this.updateLiveRegions(line,message);const lineItem=document.getElementById(`CartItem-${line}`)||document.getElementById(`CartDrawer-Item-${line}`);if(lineItem&&lineItem.querySelector(`[name="${name}"]`)?cartDrawerWrapper?trapFocus(cartDrawerWrapper,lineItem.querySelector(`[name="${name}"]`)):lineItem.querySelector(`[name="${name}"]`).focus():parsedState.item_count===0&&cartDrawerWrapper?trapFocus(cartDrawerWrapper.querySelector(".drawer__inner-empty"),cartDrawerWrapper.querySelector("a")):document.querySelector(".cart-item")&&cartDrawerWrapper&&trapFocus(cartDrawerWrapper,document.querySelector(".cart-item__name")),quantity==0){let index=+line-1;publish("levents:removeCart",{data:{index}})}publish(PUB_SUB_EVENTS.cartUpdate,{source:"cart-items"})}).catch(e=>{console.log("err",e),this.querySelectorAll(".loading-overlay").forEach(overlay=>overlay.classList.add("hidden"));const errors=document.getElementById("cart-errors")||document.getElementById("CartDrawer-CartErrors");errors.textContent=window.cartStrings.error}).finally(()=>{this.disableLoading(line),handelCartState()})}updateLiveRegions(line,message){const lineItemError=document.getElementById(`Line-item-error-${line}`)||document.getElementById(`CartDrawer-LineItemError-${line}`);lineItemError&&(lineItemError.querySelector(".cart-item__error-text").innerHTML=message),this.lineItemStatusElement.setAttribute("aria-hidden",!0);const cartStatus=document.getElementById("cart-live-region-text")||document.getElementById("CartDrawer-LiveRegionText");cartStatus.setAttribute("aria-hidden",!1),setTimeout(()=>{cartStatus.setAttribute("aria-hidden",!0)},1e3)}getSectionInnerHTML(html,selector){return new DOMParser().parseFromString(html,"text/html").querySelector(selector).innerHTML}enableLoading(line){(document.getElementById("main-cart-items")||document.getElementById("CartDrawer-CartItems")).classList.add("cart__items--disabled");const cartItemElements=this.querySelectorAll(`#CartItem-${line} .loading-overlay`),cartDrawerItemElements=this.querySelectorAll(`#CartDrawer-Item-${line} .loading-overlay`);[...cartItemElements,...cartDrawerItemElements].forEach(overlay=>overlay.classList.remove("hidden")),document.activeElement.blur(),this.lineItemStatusElement.setAttribute("aria-hidden",!1)}disableLoading(line){(document.getElementById("main-cart-items")||document.getElementById("CartDrawer-CartItems")).classList.remove("cart__items--disabled");const cartItemElements=this.querySelectorAll(`#CartItem-${line} .loading-overlay`),cartDrawerItemElements=this.querySelectorAll(`#CartDrawer-Item-${line} .loading-overlay`);cartItemElements.forEach(overlay=>overlay.classList.add("hidden")),cartDrawerItemElements.forEach(overlay=>overlay.classList.add("hidden"))}}customElements.define("cart-items",CartItems),customElements.get("cart-note")||customElements.define("cart-note",class extends HTMLElement{constructor(){super(),this.addEventListener("change",debounce(event=>{const body=JSON.stringify({note:event.target.value});fetch(`${routes.cart_update_url}`,{...fetchConfig(),body})},ON_CHANGE_DEBOUNCE_TIMER))}});class CartDrawer extends HTMLElement{constructor(){super(),this.addEventListener("keyup",evt=>evt.code==="Escape"&&this.close()),this.querySelector("#CartDrawer-Overlay").addEventListener("click",this.close.bind(this)),this.header=document.querySelector(".header-wrapper"),this.setHeaderCartIconAccessibility(),this.tabBtns=this.querySelectorAll(".drawer-tab-btn"),this.tabContent=this.querySelectorAll(".drawer-tab-content"),this.tabBtns.forEach(el=>{el.addEventListener("click",this.onTabClick.bind(this))}),window.matchMedia("(max-width: 767px)").matches&&this.dataset.autotrigger&&this.open(null,`#${this.dataset.autotrigger}`),setTimeout(()=>{console.log(this.header.getBoundingClientRect().bottom-this.borderOffset),document.documentElement.style.setProperty("--header-bottom-position",`${parseInt(this.header.getBoundingClientRect().bottom-this.borderOffset)}px`)},1e3),window.location.hash=="#account"&&document.querySelector('[data-tab="#account-drawer-tab"]').click(),window.location.hash=="#cart"&&document.querySelector('[data-tab="#cart-drawer-tab"]').click(),window.addEventListener("hashchange",function(){location.hash==="#account"&&document.querySelector('[data-tab="#account-drawer-tab"]').click(),window.location.hash=="#cart"&&document.querySelector('[data-tab="#cart-drawer-tab"]').click()}),this.swiperNav=this.querySelectorAll(".swiper-nav"),this.swiperNav&&this.swiperNav.forEach(el=>{new Swiper(el,{slidesPerView:"auto",mousewheel:!0,freeScroll:!0,navigation:{nextEl:el.querySelector(".swiper-button-next"),prevEl:el.querySelector(".swiper-button-prev")}})})}onTabClick(e){const index=e.target.dataset.index,target=e.currentTarget.getAttribute("aria-controls");this.tabBtns.forEach(el=>{el.classList.remove("active"),el.ariaSelected=!1}),this.tabContent.forEach(el=>{el.parentNode.setAttribute("hidden",!0),el.setAttribute("hidden",!0)}),this.querySelector(`#${target}`).removeAttribute("hidden"),this.querySelector(`#${target}`).parentNode.removeAttribute("hidden"),e.currentTarget.classList.add("active"),e.currentTarget.ariaSelected=!0}setHeaderCartIconAccessibility(){document.querySelectorAll(".header-trigger-drawer").forEach(cartLink=>{cartLink.setAttribute("role","button"),cartLink.setAttribute("aria-haspopup","dialog");let activeTab=cartLink.dataset.tab;cartLink.addEventListener("click",event=>{if(window.matchMedia("(max-width: 767px)").matches&&event.currentTarget.href)return window.location.href=event.currentTarget.href,!0;event.preventDefault(),this.open(cartLink,activeTab)}),cartLink.addEventListener("keydown",event=>{event.code.toUpperCase()==="SPACE"&&(event.preventDefault(),this.open(cartLink,activeTab))})})}open(triggeredBy,activeTab){window.matchMedia("(max-width: 767px)").matches&&window.scrollTo(0,0),triggeredBy&&this.setActiveElement(triggeredBy),this.header=document.querySelector(".section-header"),this.borderOffset=this.borderOffset|document.querySelector(".header-wrapper").classList.contains("header-wrapper--border-bottom")?1:0,document.documentElement.style.setProperty("--header-bottom-position",`${parseInt(this.header.getBoundingClientRect().bottom-this.borderOffset)}px`),document.documentElement.style.setProperty("--viewport-height",`${window.innerHeight}px`);const cartDrawerNote=this.querySelector('[id^="Details-"] summary');cartDrawerNote&&!cartDrawerNote.hasAttribute("role")&&this.setSummaryAccessibility(cartDrawerNote),setTimeout(()=>{this.classList.add("animate","active")}),this.addEventListener("transitionend",()=>{const containerToTrapFocusOn=this.classList.contains("is-empty")?this.querySelector(".drawer__inner-empty"):document.getElementById("CartDrawer"),focusElement=this.querySelector(".drawer__inner")||this.querySelector(".drawer__close")},{once:!0}),activeTab&&(publish("levents:drawerActive",{data:{activeTab}}),this.querySelector(activeTab).click()),document.body.classList.add("overflow-hidden")}close(){this.classList.remove("active"),removeTrapFocus(this.activeElement),document.body.classList.remove("overflow-hidden"),window.location.hash="",document.querySelectorAll("sub-drawer").forEach(el=>el.close())}setSummaryAccessibility(cartDrawerNote){cartDrawerNote.setAttribute("role","button"),cartDrawerNote.setAttribute("aria-expanded","false"),cartDrawerNote.nextElementSibling.getAttribute("id")&&cartDrawerNote.setAttribute("aria-controls",cartDrawerNote.nextElementSibling.id),cartDrawerNote.addEventListener("click",event=>{event.currentTarget.setAttribute("aria-expanded",!event.currentTarget.closest("details").hasAttribute("open"))}),cartDrawerNote.parentElement.addEventListener("keyup",onKeyUpEscape)}renderContents(parsedState,checkout,callback){if(this.querySelector(".drawer__inner").classList.contains("is-empty")&&this.querySelector(".drawer__inner").classList.remove("is-empty"),this.productId=parsedState.id,this.getSectionsToRender().forEach(section=>{const sectionElement=section.selector?document.querySelector(section.selector):document.getElementById(section.id);document.querySelector("#shopify-section-cart-drawer"),sectionElement.innerHTML=this.getSectionInnerHTML(parsedState.sections[section.id],section.selector)}),typeof callback=="function"&&callback(),window.location.pathname!==window.routes.checkout)if(checkout)this.querySelector("#CartDrawer-Checkout").click();else{if(window.matchMedia("(max-width: 767px)").matches){window.location.href="/cart";return}setTimeout(()=>{this.querySelector("#CartDrawer-Overlay").addEventListener("click",this.close.bind(this)),this.open(null,"#cart-drawer-tab")})}}getSectionInnerHTML(html,selector=".shopify-section"){return new DOMParser().parseFromString(html,"text/html").querySelector(selector).innerHTML}getSectionsToRender(){return[{id:"cart-drawer",selector:"#tab-cart-drawer"},{id:"cart-icon-bubble"}]}getSectionDOM(html,selector=".shopify-section"){return new DOMParser().parseFromString(html,"text/html").querySelector(selector)}setActiveElement(element){this.activeElement=element}}customElements.define("cart-drawer",CartDrawer);class CartDrawerItems extends CartItems{getSectionsToRender(){return[{id:"CartDrawer",section:"cart-drawer",selector:"#tab-cart-drawer-content"},{id:"cart-icon-bubble",section:"cart-icon-bubble",selector:".shopify-section"}]}}customElements.define("cart-drawer-items",CartDrawerItems);class RegisterFrom extends HTMLElement{constructor(){super(),this.form=this.querySelector("form"),this.otpPopup=document.querySelector("#PopupModal-otp-modal"),this.form.addEventListener("submit",this.submitHandler.bind(this)),Iodine.rule("phone",value=>/^[0-9\s+]+$/.test(value)),this.fields=this.form.querySelectorAll("input"),this.fields.forEach(input=>input.addEventListener("change",e=>{this.validateInput(e.currentTarget)}))}validateInput(input){let value=input.value;input.name=="phone"&&(value=input.value.replaceAll(" ",""),input.value=value);const errors=Iodine.assert(value,JSON.parse(input.dataset.rules),JSON.parse(input.dataset.messages)),label=document.getElementById(input.id+"-error");return errors.valid?(label.textContent="",!0):(label.textContent=errors.error,!1)}blockAllInputs(){this.form.querySelectorAll("input, select").forEach(input=>{input.setAttribute("readonly",!0)}),this.form.querySelector(".datepicker-input").classList.add("readonly")}unblockAllInputs(){this.form.querySelectorAll("input:not(.datepicker-input), select").forEach(input=>{input.removeAttribute("readonly")}),this.form.querySelector(".datepicker-input").classList.remove("readonly")}formatDate(inputDate){const date=new Date(inputDate),day=date.getUTCDate().toString().padStart(2,"0"),month=(date.getUTCMonth()+1).toString().padStart(2,"0"),year=date.getUTCFullYear().toString();return`${day}/${month}/${year}`}refillInformation(customer){const formData=new FormData(this.form),data=Object.fromEntries(formData);this.form.querySelector('[name="fullName"]').value=customer.name||"",this.form.classList.add("refilled"),customer.name&&this.form.querySelector('[name="fullName"]').setAttribute("readonly",!0),this.form.querySelector('[name="phone"]').value=customer.phone||"",customer.phone&&this.form.querySelector('[name="phone"]').setAttribute("readonly",!0),this.form.querySelector('[name="email"]').value=customer.email||"",customer.email&&this.form.querySelector('[name="email"]').setAttribute("readonly",!0),this.form.querySelector('[name="gender"]').value=customer.gender||"Nam",customer.gender&&this.form.querySelector('[name="gender"]').setAttribute("disabled",!0);let formattedDateString="";customer.date_of_birth?(formattedDateString=this.formatDate(customer.date_of_birth),this.form.querySelector('[name="dateOfBirth"]').value=formattedDateString,this.form.querySelector(".datepicker-input").classList.add("readonly")):this.form.querySelector('[name="dateOfBirth"]').value="",this.querySelector(".field-container").scrollTo({top:0,behavior:"smooth"})}handleResponse(res,status){{let{data,errors,meta}=res;const otpPopup=this.otpPopup;this.querySelector(".field__submit .button").classList.remove("loading"),this.otpPopup.updateModalState(status,!1),this.form.classList.remove("refilled"),errors.length>0&&!meta&&!hasActiveUrl&&(otpPopup.currentStatus=otpPopup.otpCase[5],otpPopup.goTo(0),otpPopup.show()),data||(otpPopup.currentStatus=otpPopup.otpCase[5],otpPopup.goTo(0,"verify-phone"),otpPopup.show()),delete data.otp,this.contentBody={...this.contentBody,...data};let hasActiveUrl=!1;if(data&&data.accountActivationUrl&&(hasActiveUrl=!0),meta&&meta.sessionId&&!hasActiveUrl&&(this.contentBody.sessionId=meta.sessionId),otpPopup.errors=errors,meta&&meta.responseCode&&!hasActiveUrl){if(otpPopup.meta=meta,meta.responseCode==14&&delete this.contentBody.otpEmail,otpPopup.currentStatus=otpPopup.otpCase[meta.responseCode||1],meta.responseCode==14&&(otpPopup.currentStatus=otpPopup.otpCase[1],otpPopup.resetForm()),meta.responseCode==2||meta.responseCode==3){otpPopup.goTo(4),otpPopup.show();return}(meta.responseCode==10||meta.responseCode==11||meta.responseCode==12||meta.responseCode==14)&&(this.shouldRefillInfo=!0),otpPopup.goTo(0,meta.responseCode=="12"?"verify-email":"verify-phone"),otpPopup.show();return}if(data){if(status=="form-submit"&&data.needOTPVerification&&!hasActiveUrl){otpPopup.currentStatus=otpPopup.otpCase[1],otpPopup.goTo(0,data.otpEmail?"verify-email":"verify-phone"),otpPopup.show();return}if(status=="send-otp"&&data.needOTPVerification&&!hasActiveUrl){otpPopup.currentStatus=otpPopup.otpCase[1],otpPopup.goTo(4,data.otpEmail?"verify-email":"verify-phone");return}if(data&&(hasActiveUrl||!errors.length)){otpPopup.hide(!0),delete this.contentBody.otp,this.otp=null;let{metafields,email,phone}=data,name=data.fullName||"",odooId=metafields?metafields.find(item=>item.namespace==="levents"&&item.key=="odooCustomerId"):"",dob=metafields?metafields.find(item=>item.namespace==="levents"&&item.key=="dateOfBirth"):"",gender=metafields?metafields.find(item=>item.namespace==="levents"&&item.key=="gender"):"";const customer={name,email:email||"",phone:phone||"",date_of_birth:dob?dob.value:""};window.cdpTracking&&odooId&&data.accountActivationUrl&&(customer.customer_id=odooId.value),customer.gender=gender?gender.value:"",this.accountActivationUrl=res.data.accountActivationUrl,this.shouldRefillInfo&&!hasActiveUrl&&(this.refillInformation(customer),delete this.contentBody.otpEmail,delete this.contentBody.otpPhone),hasActiveUrl&&(sessionStorage.setItem("registerSubmitted",!0),window.location.href=data.accountActivationUrl)}}}}submitHandler(event,status){if(event&&(event.preventDefault(),status="form-submit",Array.from(this.fields).map(this.validateInput).includes(!1)))return;const form=this.form,formData=new FormData(form),birthday=formData.get("dateOfBirth");if(birthday){const[day,month,year]=birthday.split("/"),formattedDateString=`${year}-${month}-${day}`,isoString=new Date(formattedDateString).toISOString();formData.set("dateOfBirth",isoString)}this.otp&&this.contentBody&&status!="send-otp"&&(formData.set("otp",this.otp),this.contentBody.otp=this.otp);const dataObject=Object.fromEntries(formData);this.contentBody={...this.contentBody,...dataObject};const body=JSON.stringify(this.contentBody);status=="form-submit"&&this.querySelector(".field__submit .button").classList.add("loading"),this.otpPopup.updateModalState(status,!0),fetch(`${window.apiUrl}/accounts/register`,{method:"POST",headers:{"Content-Type":"application/json"},body}).then(response=>response.json()).then(res=>this.handleResponse(res,status))}}customElements.define("register-form",RegisterFrom);class OTPModal extends ModalDialog{constructor(){super(),this.otpInputs=this.querySelectorAll(".otp-modal__field"),this.verifyButtons=this.querySelectorAll("[data-verify]"),this.registerForm=document.querySelector("register-form"),this.errorMessage=this.querySelectorAll(".otp-modal__error"),this.sendOTPButtons=this.querySelectorAll("[data-send-otp]"),this.otpCase={1:{id:1,title:"X\xE1c nh\u1EADn s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",content:"B\u1EA1n vui l\xF2ng x\xE1c th\u1EF1c b\u1EB1ng h\xECnh th\u1EE9c nh\u1EADp OTP",cta:["data-close-modal","data-send-otp","data-verify"]},2:{id:2,title:"Nh\u1EADp m\xE3 OTP",content:"B\u1EA1n c\xF3 th\u1EC3 x\xE1c th\u1EF1c m\xE3 OTP l\u1EA7n ti\u1EBFp theo sau 12 ti\u1EBFng",error:"",cta:["data-send-otp","data-verify"]},3:{id:3,title:"Nh\u1EADp m\xE3 OTP",content:"B\u1EA1n c\xF2n [[otpAttempts]] l\u1EA7n g\u1EEDi l\u1EA1i m\xE3 x\xE1c th\u1EF1c (OTP)",cta:["data-send-otp","data-verify"],error:"M\xE3 x\xE1c nh\u1EADn kh\xF4ng ch\xEDnh x\xE1c. B\u1EA1n c\xF2n [[otpAttempts]] l\u1EA7n nh\u1EADp m\xE3 OTP"},4:{id:4,error:"\u0110\xE3 x\u1EA3y ra s\u1EF1 c\u1ED1",cta:["data-close-modal"]},5:{id:5,error:"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh \u1EDF m\xE1y ch\u1EE7.",cta:["data-close-modal"]},6:{id:6,error:"Thi\u1EBFu th\xF4ng tin email.",cta:["data-close-modal"]},7:{id:7,error:"Thi\u1EBFu th\xF4ng tin s\u1ED1 \u0111i\u1EC7n tho\u1EA1i.",cta:["data-close-modal"]},8:{id:8,error:"Thi\u1EBFu c\u1EA3 2 th\xF4ng tin email v\xE0 s\u1ED1 \u0111i\u1EC7n tho\u1EA1i.",cta:["data-close-modal"]},9:{id:9,title:"T\xE0i kho\u1EA3n n\xE0y \u0111\xE3 b\u1ECB kh\xF3a b\u1EDFi ng\u01B0\u1EDDi qu\u1EA3n tr\u1ECB.",cta:["data-close-modal"]},10:{id:10,title:"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i v\xE0 Email \u0111\xE3 t\u1ED3n t\u1EA1i",content:"Vui l\xF2ng nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i v\xE0 email kh\xE1c ho\u1EB7c l\u1EA5y l\u1EA1i th\xF4ng tin b\u1EB1ng c\xE1ch x\xE1c nh\u1EADn OTP qua s\u1ED1 \u0111i\u1EC7n tho\u1EA1i",cta:["data-close-modal","data-send-otp"]},11:{id:11,title:"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i \u0111\xE3 t\u1ED3n t\u1EA1i",content:"Vui l\xF2ng nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xE1c ho\u1EB7c l\u1EA5y l\u1EA1i th\xF4ng tin b\u1EB1ng c\xE1ch x\xE1c nh\u1EADn OTP",cta:["data-close-modal","data-send-otp"]},12:{id:12,title:"Email \u0111\xE3 t\u1ED3n t\u1EA1i",content:"Vui l\xF2ng nh\u1EADp Email kh\xE1c ho\u1EB7c  l\u1EA5y l\u1EA1i th\xF4ng tin b\u1EB1ng c\xE1ch x\xE1c nh\u1EADn OTP",cta:["data-close-modal","data-send-otp"]},15:{id:15,title:"T\xE0i kho\u1EA3n \u0111\xE3 t\u1ED3n t\u1EA1i",content:"Vui l\xF2ng nh\u1EADp email ho\u1EB7c s\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xE1c. Ho\u1EB7c  <a class='link' href='/account/login#recover'>l\u1EA5y l\u1EA1i m\u1EADt kh\u1EA9u </a> ",cta:["data-close-modal"]},16:{id:16,title:"Email \u0111\xE3 t\u1ED3n t\u1EA1i",content:"Vui l\xF2ng nh\u1EADp Email kh\xE1c",cta:["data-close-modal"]},17:{id:17,error:"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i sai kh\xF4ng \u0111\xFAng",cta:["data-close-modal"]}},this.currentStatus=this.otpCase[1],this.bindEvents()}bindEvents(){this.otpInputs.forEach((el,index)=>el.addEventListener("input",e=>{this.onOTPChange(e,index)})),this.querySelectorAll("[data-show-step]").forEach(element=>{element.addEventListener("click",e=>{let step=e.currentTarget.dataset.showStep;this.goTo(step)})}),this.verifyButtons.forEach(element=>{element.addEventListener("click",this.verifySuccess.bind(this))}),this.querySelectorAll("[data-close-modal]").forEach(element=>{element.addEventListener("click",this.hide.bind(this))}),this.sendOTPButtons.forEach(element=>{element.addEventListener("click",this.sendOTP.bind(this))}),this.querySelector(".otp-form").addEventListener("paste",this.pasteOTP.bind(this))}updateModalState(status,isLoading){this.classList.toggle("modal--loading",isLoading),this.classList.toggle("modal--block",isLoading),this.sendOTPButtons.forEach(el=>el.classList.toggle("loading",status=="send-otp"&&isLoading)),this.verifyButtons.forEach(el=>el.classList.toggle("loading",status=="verify-otp"&&isLoading))}sendOTP(e){this.registerForm.submitHandler(null,"send-otp"),this.meta=null}onOTPChange(e,index){let fields=Array.from(this.otpInputs),isEnabled=fields.every(input=>input.value);if(e.currentTarget.value&&index<fields.length-1&&fields[index+1].focus(),this.meta&&this.meta.responseCode==2){this.verifyButtons.forEach(el=>el.setAttribute("disabled",!0));return}this.verifyButtons.forEach(el=>isEnabled?el.removeAttribute("disabled"):el.setAttribute("disabled",!0))}renderOTPContent(status,otpContent){if(otpContent){let error=status.error,content=status.content;if(this.meta&&this.meta.responseCode==3){const{otpMaxAttempts,otpAttempts}=this.meta;error=error.replace("[[otpAttempts]]",otpMaxAttempts-otpAttempts),content=content.replace("[[otpAttempts]]",otpMaxAttempts-otpAttempts),otpMaxAttempts==otpAttempts&&(error=`B\u1EA1n \u0111\xE3 nh\u1EADp sai OTP t\u1ED1i \u0111a ${otpMaxAttempts} l\u1EA7n. Vui l\xF2ng ch\u1ECDn g\u1EEDi l\u1EA1i OTP`,this.classList.remove("modal--block"))}this.meta&&this.meta.responseCode==2&&this.classList.remove("modal--block"),otpContent.querySelector(".otp-modal__title").textContent=status.title||"",otpContent.querySelector(".otp-modal__text").innerHTML=content||"",otpContent.querySelector(".otp-modal__error").textContent=error||"",error&&otpContent.querySelector(".otp-modal__error").classList.remove("hidden");const cta=["[data-close-modal]","[data-send-otp]","[data-verify]"];let dataQuery=[];otpContent.querySelectorAll(cta.join(", ")).forEach(el=>el.classList.add("hidden")),status.cta&&(dataQuery=status.cta.map(item=>{let data=`[${item}]`;if(cta.includes(data))return data}).filter(Boolean),dataQuery.length&&otpContent.querySelectorAll(dataQuery.join(", ")).forEach(el=>el.classList.remove("hidden")))}}renderOTPError(status){if(status.error){let error=status.error;this.errorMessage.forEach(el=>el.textContent=el.textContent=error)}}hide(session){if(this.meta&&this.meta.responseCode==3){const{otpMaxAttempts,otpAttempts}=this.meta;otpMaxAttempts==otpAttempts&&(this.registerForm.contentBody=null)}this.meta&&this.meta.responseCode==2&&(this.registerForm.contentBody=null),this.registerForm&&this.registerForm.contentBody&&!session&&(delete this.registerForm.contentBody.needOTPVerification,delete this.registerForm.contentBody.sessionId),this.resetForm(),super.hide()}pasteOTP(event){event.preventDefault();var pastedData=(event.clipboardData||window.clipboardData).getData("text");this.otpInputs.forEach((input,index)=>{input.value=pastedData[index]||"";var event2=new Event("input");input.dispatchEvent(event2)})}goTo(step,verify){this.querySelectorAll(".otp-modal__content").forEach(tab=>{this.currentStatus.title&&this.currentStatus.id==1&&(this.currentStatus.title=verify=="verify-email"?"X\xE1c nh\u1EADn email":"X\xE1c nh\u1EADn s\u1ED1 \u0111i\u1EC7n tho\u1EA1i"),step==4&&(this.currentStatus.title&&(console.log(verify),this.currentStatus.title="Nh\u1EADp m\xE3 OTP"),this.classList.add("modal--block")),step==0&&(this.querySelector(".otp-form").reset(),this.querySelector(".otp-modal__error").classList.add("hidden")),this.renderOTPContent(this.currentStatus,this.querySelector(`[data-step="${step}"]`),verify),tab&&tab.dataset.step==step?tab.classList.remove("hidden"):tab.classList.add("hidden")})}resetForm(){this.goTo("0"),this.querySelector(".otp-form").reset(),this.querySelector(".otp-modal__error").classList.add("hidden"),this.registerForm.otp=""}verifySuccess(){let OTPValue="";this.otpInputs.forEach(input=>{OTPValue+=input.value}),this.registerForm.otp=OTPValue,this.registerForm.submitHandler(null,"verify-otp")}}customElements.define("otp-modal",OTPModal);class LoginForm extends HTMLElement{constructor(){super(),this.form=this.querySelector("form"),this.form.addEventListener("submit",this.submitHandler.bind(this))}submitHandler(e){return e.preventDefault(),sessionStorage.setItem("loginSubmitted",!0),!0}}customElements.define("login-form",LoginForm);class CustomerAddresses extends HTMLElement{constructor(){super(),this.addressList=this.querySelector(".address-list"),this.editDrawer=document.querySelector("#edit-address-drawer"),this.addDrawer=document.querySelector("#add-address-drawer"),this.mainUrl=window.apiUrl,this.getAddressList()}initEvent(){this.querySelectorAll(".edit-address").forEach(e=>e.addEventListener("click",this.showEditAddressDrawer.bind(this))),this.querySelectorAll(".add-address").forEach(e=>e.addEventListener("click",this.showAddAddressDrawer.bind(this))),this.querySelectorAll(".delete-address").forEach(e=>e.addEventListener("click",this.removeAddress.bind(this)))}getAddressList(){this.addressList.classList.add("loading"),fetch("/account/addresses?section_id=main-addresses").then(response=>response.text()).then(responseText=>{const source=new DOMParser().parseFromString(responseText,"text/html").querySelector("#shopify-section-main-addresses");source&&(this.addressList.innerHTML=source.innerHTML,this.querySelector(".field__submit").classList.toggle("hidden",!this.addressList.querySelector(".address-item")),this.addressList.classList.remove("loading")),this.initEvent()})}showEditAddressDrawer(e){let id=e.currentTarget.dataset.addressId,addressJSON=document.querySelector(`#address-json-${id}`);if(addressJSON&&JSON.parse(addressJSON.textContent)){let address=JSON.parse(addressJSON.textContent);this.editDrawer.querySelector("address-form").initAddress(address),this.editDrawer.open()}}showAddAddressDrawer(){console.log(this.addDrawer.querySelector("address-form")),this.addDrawer.querySelector("address-form").initAddress()}removeAddress(e){let $submit=e.target,action=$submit.getAttribute("data-target"),message=$submit.getAttribute("data-confirm-message");confirm(message)&&fetch(action,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"_method=delete"}).then(response=>{response.ok?this.getAddressList():console.error("Request failed:",response.status,response.statusText)}).catch(error=>{console.error("Error:",error)})}adNewAddress(){}}customElements.define("customer-addresses",CustomerAddresses);class AddressForm extends HTMLElement{constructor(){super(),this.formQueries={first_name:"address[first_name]",last_name:"address[last_name]",phone:"address[phone]",city:"address[city]",district:"address[district]",province:"address[province]",ward:"address[ward]",address1:"address[address1]",zip:"address[zip]",default:"address[default]"},this.mainUrl=window.apiUrl,this.form=this.querySelector("form"),this.fields=this.form.querySelectorAll("input,select"),this.querySelector(`[name="${this.formQueries.city}"]`).addEventListener("change",this.onCityChange.bind(this)),this.querySelector(`[name="${this.formQueries.district}"]`).addEventListener("change",this.onDistrictChange.bind(this)),this.form.addEventListener("submit",this.onSubmit.bind(this)),this.fields.forEach(el=>el.addEventListener("change",e=>{this.validateInput(e.currentTarget)}))}async loadDistrict(province){try{return(await(await fetch(`${this.mainUrl}/locations/provinces?name=${province}`,{method:"GET",redirect:"follow"})).json()).data}catch{return[]}}async initAddress(address){if(this.address=address,this.form.classList.add("loading"),this.initCity(),address){if(address.address1){let addressDetail=address.address1.split(",").map(item=>item.trim());address.address1=addressDetail[0],address.ward=addressDetail[1]||"",address.district=addressDetail[2]||""}if(address.city){let districtData=await this.loadDistrict(address.city);if(districtData){this.districtData=districtData,this.districtData&&this.renderDistrict(this.districtData.districts||[]);let currentDistrict=this.districtData.districts.find(item=>item.name==address.district);currentDistrict&&this.renderWard(currentDistrict.wards||[])}}Object.keys(this.formQueries).forEach(key=>{let input=this.querySelector(`[name="${this.formQueries[key]}"]`);input&&(key=="default"?input.checked=address[key]:input.value=address[key]?address[key].trim():"")})}this.form.classList.remove("loading")}async onCityChange(e){let district=e.currentTarget.value,districtData=await this.loadDistrict(district);this.form.classList.add("loading"),this.districtData=[],districtData&&(this.districtData=districtData,this.districtData&&this.renderDistrict(this.districtData.districts||[]),this.renderWard([]),this.querySelector(`[name="${this.formQueries.zip}"]`).value=this.districtData.zip_code,this.form.classList.remove("loading"))}onDistrictChange(e){let currentDistrict=this.districtData&&this.districtData.districts.find(item=>item.name==e.currentTarget.value);currentDistrict&&this.renderWard(currentDistrict.wards||[])}async initCity(){if(this.querySelector(".address-city.loaded"))return;let response=await fetch(`${this.mainUrl}/locations/provinces?onlyProvince=true`),{data}=await response.json();if(data){let currCity=this.address?this.address.city:"";this.listCity=this.sortCity(data);let cityOptions=data.map(city=>`<option value="${city.name}" ${currCity==city.name?"selected":""}>${city.name}</option>`);this.querySelectorAll(".address-city").forEach(select=>{select.innerHTML=`
              <option value=""> Ch\u1ECDn T\u1EC9nh / Th\xE0nh ph\u1ED1</option>
            ${cityOptions.join("")}
        `,select.classList.add("loaded")})}}removeDuplicateObj(data,propName){const uniqueKeys=new Set;return data.filter(obj=>uniqueKeys.has(obj[propName])?!1:(uniqueKeys.add(obj[propName]),!0))}sortCity(data){let customSort=(a,b)=>{const order={"T\u1EC9nh/ Th\xE0nh Ph\u1ED1":0,"H\u1ED3 Ch\xED Minh":1,"H\xE0 N\u1ED9i":2},aIndex=order[a.name]!==void 0?order[a.name]:3,bIndex=order[b.name]!==void 0?order[b.name]:3;return aIndex!==bIndex?aIndex-bIndex:a.name.localeCompare(b.name)},processData=data.sort(customSort);return this.removeDuplicateObj(processData,"name")}renderWard(data){let wardOptions=this.sortWard(data||[]).map(ward=>`<option value="${ward.name}"  >${ward.name}</option>`);this.querySelector(`[name="${this.formQueries.ward}"]`).innerHTML=`<option value="">Ch\u1ECDn Ph\u01B0\u1EDDng / X\xE3 </option> ${wardOptions.join("")}`}renderDistrict(data){let districtOptions=this.sortDistrict(data||[]).map(district=>`<option value="${district.name}"  >${district.name}</option>`);this.querySelector(`[name="${this.formQueries.district}"]`).innerHTML=`<option value="">Ch\u1ECDn Qu\u1EADn / Huy\u1EC7n </option> ${districtOptions.join("")}`}sortDistrict(data){let customSort=(a,b)=>{const aIsQuan=a.name.startsWith("Qu\u1EADn"),bIsQuan=b.name.startsWith("Qu\u1EADn"),aIsHuyen=a.name.startsWith("Huy\u1EC7n"),bIsHuyen=b.name.startsWith("Huy\u1EC7n");if(aIsQuan&&!bIsQuan)return-1;if(!aIsQuan&&bIsQuan)return 1;if(aIsHuyen&&!bIsHuyen)return-1;if(!aIsHuyen&&bIsHuyen)return 1;if(aIsQuan&&bIsQuan){const aNameWithoutPrefix=a.name.replace("Qu\u1EADn ",""),bNameWithoutPrefix=b.name.replace("Qu\u1EADn ",""),aNumber=parseInt(aNameWithoutPrefix),bNumber=parseInt(bNameWithoutPrefix);if(!isNaN(aNumber)&&!isNaN(bNumber))return aNumber-bNumber;if(isNaN(aNumber)){if(!isNaN(bNumber))return 1}else return-1}return a.name.localeCompare(b.name)},processData=data.sort(customSort);return this.removeDuplicateObj(processData,"name")}sortWard(data){const customSort=(a,b)=>{const aIsPhuong=a.name.startsWith("Ph\u01B0\u1EDDng"),bIsPhuong=b.name.startsWith("Ph\u01B0\u1EDDng");if(aIsPhuong&&!bIsPhuong)return-1;if(!aIsPhuong&&bIsPhuong)return 1;if(aIsPhuong&&bIsPhuong){const aNameWithoutPrefix=a.name.replace("Ph\u01B0\u1EDDng ",""),bNameWithoutPrefix=b.name.replace("Ph\u01B0\u1EDDng ",""),aNumber=parseInt(aNameWithoutPrefix),bNumber=parseInt(bNameWithoutPrefix);if(!isNaN(aNumber)&&!isNaN(bNumber))return aNumber-bNumber;if(isNaN(aNumber)){if(!isNaN(bNumber))return 1}else return-1}return a.name.localeCompare(b.name)};return data.sort(customSort).filter((value,index,self)=>self.indexOf(value)===index)}validateInput(input){let value=input.value;if(input.type=="tel"&&(value=input.value.replaceAll(" ","").replace("+84","0"),input.value=value),!input.dataset.rules||!input.dataset.messages)return!0;const errors=Iodine.assert(value,JSON.parse(input.dataset.rules),JSON.parse(input.dataset.messages));let label=document.getElementById(input.id+"-error");return label||(label=document.createElement("span"),label.id=input.id+"-error",label.classList.add("error"),input.closest(".field").appendChild(label)),errors.valid?(input.classList.remove("is-valid"),label.textContent="",!0):(label.textContent=errors.error,input.classList.add("is-valid"),!1)}onSubmit(e){if(e.preventDefault(),Array.from(this.fields).map(this.validateInput).includes(!1))return;let url=this.form.action;this.address&&this.address.id&&(url=url+"/"+this.address.id),this.form.classList.add("loading");const formData=new FormData(this.form);let address1=formData.get("address[address1]");const ward=formData.get("address[ward]"),district=formData.get("address[district]");address1=[address1,ward,district].map(item=>item.trim()).filter(Boolean).join(", "),formData.set("address[address1]",address1),fetch(url,{method:"POST",body:formData}).then(response=>{response.status===200&&(document.querySelectorAll("customer-addresses").forEach(el=>el.getAddressList()),this.closest("sub-drawer").close(),this.form.classList.remove("loading"))}).catch(error=>{console.error("Error:",error)})}}customElements.define("address-form",AddressForm);class VoucherModal extends ModalDialog{constructor(){super(),this.customerId=this.dataset.customer,this.voucherData=JSON.parse(this.querySelector('[type="application/json"]').textContent),this.currentPoint=+this.dataset.currentPoint,this.redeemButton=this.querySelector(".voucher-popup-modal__reddem"),this.redeemButton.addEventListener("click",this.redeemVoucher.bind(this))}show(opener){this.opener=opener,this.programId=this.opener.dataset.programId,this.renderVoucherContent(this.programId),this.classList.remove("has-error"),super.show()}renderVoucherContent(id){const voucher=this.voucherData.find(item=>item.program_id==id);if(voucher){this.querySelector(".voucher-modal__title").textContent=voucher.description;let newRwardPoints=this.currentPoint-voucher.points;this.querySelector(".voucher-modal__text").textContent=`Sau khi \u0111\u1ED5i voucher b\u1EA1n s\u1EBD c\xF2n ${Utils.formatNumberWithSeparator(newRwardPoints,"",".")}  LVS`}else this.onError("Kh\xF4ng t\xECm th\u1EA5y th\xF4ng tin voucher")}onError(errorMessage){this.querySelector(".voucher-modal__title").textContent="",this.querySelector(".voucher-modal__text").textContent=errorMessage,this.classList.add("has-error")}redeemVoucher(){const data={customer_id:this.customerId,program_id:this.programId,host:Shopify.shop},body=JSON.stringify(data);this.redeemButton.classList.add("loading"),fetch(`${window.apiUrl}/odoo/api/v2/call?model=loyalty.card&method=redeem_voucher`,{method:"POST",headers:{"Content-Type":"application/json"},body}).then(response=>{if(response.status===200)return response.json();this.redeemButton.classList.remove("loading"),this.onError("\u0110\xE3 x\u1EA3y ra s\u1EF1 c\u1ED1")}).then(res=>{res&&res.points&&(this.redeemButton.classList.remove("loading"),this.hide(),document.querySelectorAll("[data-reward-points]").forEach(el=>{el.dataset.rewardPoints=res.new_reward_points,el.textContent=Utils.formatNumberWithSeparator(res.new_reward_points,"","."),this.currentPoint=res.new_reward_points}))}).catch(error=>{this.redeemButton.classList.remove("loading"),this.onError("\u0110\xE3 x\u1EA3y ra s\u1EF1 c\u1ED1")})}}customElements.define("voucher-modal",VoucherModal);class GiftModal extends ModalDialog{constructor(){super(),this.customerId=this.dataset.customer,this.voucherData=JSON.parse(this.querySelector('[type="application/json"]').textContent),this.currentPoint=+this.dataset.currentPoint,this.redeemButton=this.querySelector(".voucher-popup-modal__reddem"),this.redeemButton.addEventListener("click",this.redeemVoucher.bind(this))}show(opener){this.opener=opener,this.programId=this.opener.dataset.programId,this.product=this.opener.dataset.product,this.renderVoucherContent(this.programId),this.classList.remove("has-error"),super.show()}renderVoucherContent(id){const voucher=this.voucherData.find(item=>item.program_id==id);if(voucher){this.querySelector(".voucher-modal__title").textContent=voucher.description;let newRwardPoints=this.currentPoint-voucher.points;this.querySelector(".voucher-modal__text").textContent=`Sau khi \u0111\u1ED5i qu\xE0 b\u1EA1n s\u1EBD c\xF2n ${Utils.formatNumberWithSeparator(newRwardPoints,"",".")}  LVS`}else this.onError("Kh\xF4ng t\xECm th\u1EA5y th\xF4ng tin voucher")}onError(errorMessage){this.querySelector(".voucher-modal__title").textContent="",this.querySelector(".voucher-modal__text").textContent=errorMessage,this.classList.add("has-error")}redeemSuccess(code){const storage={product:this.product,code};sessionStorage.setItem("redeem-gift",JSON.stringify(storage)),this.redeemButton.classList.remove("loading"),this.hide(),window.location.href="/pages/gift"}redeemVoucher(){const data={customer_id:this.customerId,program_id:this.programId,host:Shopify.shop},body=JSON.stringify(data);this.redeemButton.classList.add("loading"),fetch(`${window.apiUrl}/odoo/api/v2/call?model=loyalty.card&method=redeem_voucher`,{method:"POST",headers:{"Content-Type":"application/json"},body}).then(response=>{if(response.status===200)return response.json();this.redeemButton.classList.remove("loading"),this.onError("\u0110\xE3 x\u1EA3y ra s\u1EF1 c\u1ED1")}).then(res=>{res&&res.points&&(this.redeemButton.classList.remove("loading"),this.hide(),document.querySelectorAll("[data-reward-points]").forEach(el=>{el.dataset.rewardPoints=res.new_reward_points,el.textContent=Utils.formatNumberWithSeparator(res.new_reward_points,"","."),this.currentPoint=res.new_reward_points}),console.log(res),this.redeemSuccess(res.code))}).catch(error=>{this.redeemButton.classList.remove("loading"),this.onError("\u0110\xE3 x\u1EA3y ra s\u1EF1 c\u1ED1")})}}customElements.define("gift-modal",GiftModal);
//# sourceMappingURL=/cdn/shop/t/8/assets/drawer.js.map?v=48897048303605830731735013604
